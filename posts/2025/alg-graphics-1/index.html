<!doctype html><html lang=cn dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>å¿«é€Ÿæ±‚è§£å¹³æ–¹æ ¹å€’æ•°ç®—æ³• | MoonLab</title>
<meta name=keywords content><meta name=description content="æœ¬æ–‡ä»‹ç»äº†ä¸€ç§å¿«é€Ÿè®¡ç®—å¹³æ–¹æ ¹å€’æ•°çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•æºäºä¸Šä¸–çºª90å¹´ä»£ã€‚æ–‡ç« é¦–å…ˆè§£é‡Šäº†æµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯float32æ ¼å¼çš„ç»“æ„ï¼ŒåŒ…æ‹¬ç¬¦å·ä½ã€æŒ‡æ•°ä½å’Œå°¾æ•°ä½ã€‚æ¥ç€ï¼Œä»‹ç»äº†ç‰›é¡¿è¿­ä»£æ³•çš„åŸºæœ¬åŸç†åŠå…¶åœ¨æ±‚è§£å¹³æ–¹æ ¹å€’æ•°ä¸­çš„åº”ç”¨ã€‚é€šè¿‡å¯¹æµ®ç‚¹æ•°çš„å¯¹æ•°å˜æ¢ï¼Œæ¨å¯¼å‡ºä¸å¹³æ–¹æ ¹å€’æ•°ç›¸å…³çš„å…¬å¼ï¼Œå¹¶è§£é‡Šäº†ä»£ç ä¸­ä½¿ç”¨çš„ç¥ç§˜å¸¸æ•° 0x5f3759df çš„æ¥æºï¼Œæœ€åæåˆ°åˆ‡æ¯”é›ªå¤«æœ€ä½³é€¼è¿‘çš„æ¦‚å¿µï¼Œä»¥ä¼˜åŒ–è®¡ç®—ç»“æœã€‚"><meta name=author content="LingC"><link rel=canonical href=https://moonlab.top/posts/2025/alg-graphics-1/><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"],["$","$"]]},loader:{load:["ui/safe"]}}</script><link crossorigin=anonymous href=/assets/css/stylesheet.1ff5a7b3bb4a96bf1747dfa25e8031167d4537d7ae4b78fac2b752886047a06e.css rel="preload stylesheet" as=style><link rel=icon href=/moon.svg type=image/svg+xml><link rel=icon type=image/png sizes=16x16 href=https://moonlab.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://moonlab.top/favicon-32x32.png><link rel=apple-touch-icon href=https://moonlab.top/apple-touch-icon.png><link rel=mask-icon href=https://moonlab.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=cn href=https://moonlab.top/posts/2025/alg-graphics-1/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="å¿«é€Ÿæ±‚è§£å¹³æ–¹æ ¹å€’æ•°ç®—æ³•"><meta property="og:description" content="æœ¬æ–‡ä»‹ç»äº†ä¸€ç§å¿«é€Ÿè®¡ç®—å¹³æ–¹æ ¹å€’æ•°çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•æºäºä¸Šä¸–çºª90å¹´ä»£ã€‚æ–‡ç« é¦–å…ˆè§£é‡Šäº†æµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯float32æ ¼å¼çš„ç»“æ„ï¼ŒåŒ…æ‹¬ç¬¦å·ä½ã€æŒ‡æ•°ä½å’Œå°¾æ•°ä½ã€‚æ¥ç€ï¼Œä»‹ç»äº†ç‰›é¡¿è¿­ä»£æ³•çš„åŸºæœ¬åŸç†åŠå…¶åœ¨æ±‚è§£å¹³æ–¹æ ¹å€’æ•°ä¸­çš„åº”ç”¨ã€‚é€šè¿‡å¯¹æµ®ç‚¹æ•°çš„å¯¹æ•°å˜æ¢ï¼Œæ¨å¯¼å‡ºä¸å¹³æ–¹æ ¹å€’æ•°ç›¸å…³çš„å…¬å¼ï¼Œå¹¶è§£é‡Šäº†ä»£ç ä¸­ä½¿ç”¨çš„ç¥ç§˜å¸¸æ•° 0x5f3759df çš„æ¥æºï¼Œæœ€åæåˆ°åˆ‡æ¯”é›ªå¤«æœ€ä½³é€¼è¿‘çš„æ¦‚å¿µï¼Œä»¥ä¼˜åŒ–è®¡ç®—ç»“æœã€‚"><meta property="og:type" content="article"><meta property="og:url" content="https://moonlab.top/posts/2025/alg-graphics-1/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-02-04T21:35:38+08:00"><meta property="article:modified_time" content="2025-02-04T21:35:38+08:00"><meta property="og:site_name" content="MoonLab"><meta name=twitter:card content="summary"><meta name=twitter:title content="å¿«é€Ÿæ±‚è§£å¹³æ–¹æ ¹å€’æ•°ç®—æ³•"><meta name=twitter:description content="æœ¬æ–‡ä»‹ç»äº†ä¸€ç§å¿«é€Ÿè®¡ç®—å¹³æ–¹æ ¹å€’æ•°çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•æºäºä¸Šä¸–çºª90å¹´ä»£ã€‚æ–‡ç« é¦–å…ˆè§£é‡Šäº†æµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯float32æ ¼å¼çš„ç»“æ„ï¼ŒåŒ…æ‹¬ç¬¦å·ä½ã€æŒ‡æ•°ä½å’Œå°¾æ•°ä½ã€‚æ¥ç€ï¼Œä»‹ç»äº†ç‰›é¡¿è¿­ä»£æ³•çš„åŸºæœ¬åŸç†åŠå…¶åœ¨æ±‚è§£å¹³æ–¹æ ¹å€’æ•°ä¸­çš„åº”ç”¨ã€‚é€šè¿‡å¯¹æµ®ç‚¹æ•°çš„å¯¹æ•°å˜æ¢ï¼Œæ¨å¯¼å‡ºä¸å¹³æ–¹æ ¹å€’æ•°ç›¸å…³çš„å…¬å¼ï¼Œå¹¶è§£é‡Šäº†ä»£ç ä¸­ä½¿ç”¨çš„ç¥ç§˜å¸¸æ•° 0x5f3759df çš„æ¥æºï¼Œæœ€åæåˆ°åˆ‡æ¯”é›ªå¤«æœ€ä½³é€¼è¿‘çš„æ¦‚å¿µï¼Œä»¥ä¼˜åŒ–è®¡ç®—ç»“æœã€‚"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://moonlab.top/posts/"},{"@type":"ListItem","position":2,"name":"å¿«é€Ÿæ±‚è§£å¹³æ–¹æ ¹å€’æ•°ç®—æ³•","item":"https://moonlab.top/posts/2025/alg-graphics-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"å¿«é€Ÿæ±‚è§£å¹³æ–¹æ ¹å€’æ•°ç®—æ³•","name":"å¿«é€Ÿæ±‚è§£å¹³æ–¹æ ¹å€’æ•°ç®—æ³•","description":"æœ¬æ–‡ä»‹ç»äº†ä¸€ç§å¿«é€Ÿè®¡ç®—å¹³æ–¹æ ¹å€’æ•°çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•æºäºä¸Šä¸–çºª90å¹´ä»£ã€‚æ–‡ç« é¦–å…ˆè§£é‡Šäº†æµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯float32æ ¼å¼çš„ç»“æ„ï¼ŒåŒ…æ‹¬ç¬¦å·ä½ã€æŒ‡æ•°ä½å’Œå°¾æ•°ä½ã€‚æ¥ç€ï¼Œä»‹ç»äº†ç‰›é¡¿è¿­ä»£æ³•çš„åŸºæœ¬åŸç†åŠå…¶åœ¨æ±‚è§£å¹³æ–¹æ ¹å€’æ•°ä¸­çš„åº”ç”¨ã€‚é€šè¿‡å¯¹æµ®ç‚¹æ•°çš„å¯¹æ•°å˜æ¢ï¼Œæ¨å¯¼å‡ºä¸å¹³æ–¹æ ¹å€’æ•°ç›¸å…³çš„å…¬å¼ï¼Œå¹¶è§£é‡Šäº†ä»£ç ä¸­ä½¿ç”¨çš„ç¥ç§˜å¸¸æ•° 0x5f3759df çš„æ¥æºï¼Œæœ€åæåˆ°åˆ‡æ¯”é›ªå¤«æœ€ä½³é€¼è¿‘çš„æ¦‚å¿µï¼Œä»¥ä¼˜åŒ–è®¡ç®—ç»“æœã€‚","keywords":[],"articleBody":"å¯¹äºå¿«é€Ÿè®¡ç®—å‡ºå¹³æ–¹æ ¹å€’æ•° $\\frac{1}{\\sqrt{x}}$ï¼Œæœ‰ä¸€ä¸ªä¸Šä¸–çºª90å¹´ä»£çš„ç»å…¸ç®—æ³•ï¼š\nfloat Q_rsqrt( float number ) { long i; float x2, y; const float threehalfs = 1.5F; x2 = number * 0.5F; y = number; i = * ( long * ) \u0026y; // evil floating point bit level hacking i = 0x5f3759df - ( i \u003e\u003e 1 ); // what the fuck? y = * ( float * ) \u0026i; y = y * ( threehalfs - ( x2 * y * y ) ); // 1st iteration // y = y * ( threehalfs - ( x2 * y * y ) ); // 2nd iteration, this can be removed return y; } æ‰«ç›²ï¼šæµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„å‚¨å­˜ float32å’Œdouble64éƒ½ç”± IEE754 æ ‡å‡†å®šä¹‰ï¼Œåœ¨è¿™é‡Œåªç®€å•äº†è§£float32ã€‚\nåœ¨è¿™32ä½ä¸­åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:\nSign ç¬¦å·ï¼š0ä»£è¡¨æ•´æ•°ï¼Œ1ä»£è¡¨è´Ÿæ•° Exponent æŒ‡æ•°ä½ äºŒè¿›åˆ¶çš„8bitå¯ä»¥è¡¨ç¤º256ç§çŠ¶æ€ï¼Œè€ŒIEE754è§„å®šï¼Œè¿™å…«ä½ç”¨äºè¡¨ç¤º[-127, 127]èŒƒå›´å†…çš„æŒ‡æ•°ã€‚ ä¸ºäº†æ–¹ä¾¿åœ°è¡¨ç¤ºè´Ÿæ•°ï¼Œå…¶è§„å®šåœ¨float32ä¸­æŒ‡æ•°çš„åç§»é‡ä¸º127ï¼Œå› æ­¤æŒ‡æ•°çš„å®é™…å€¼ä¸ºe = exponent - 127ã€‚ è¿™å°†ç¡®ä¿ä»¥äºŒè¿›åˆ¶å‚¨å­˜çš„biased exponentæ€»æ˜¯éè´Ÿæ•´æ•°ã€‚\nFraction å°¾æ•°ä½ å°¾æ•°ä½åœ¨æ ¼å¼ä¸­æœ‰23ä½ï¼Œå› æ­¤å¯ä»¥è¡¨ç¤ºçš„ç²¾åº¦ä¸º2^-23ï¼Œçº¦ç­‰äº1.19 * 10^-7ã€‚\nå¦‚æœ‰ä¸€ä¸ªåè¿›åˆ¶æ•°13.62ï¼Œå°†æ•´æ•°éƒ¨åˆ†é™¤2å–ä½™é€†åºæ’åˆ—ä¸º1101ï¼Œå°†å°æ•°éƒ¨åˆ†ä¹˜2å–æ•´é¡ºåºæ’åˆ—ä¸º101ã€‚è¿™ä¸ªåè¿›åˆ¶å°æ•°åœ¨äºŒè¿›åˆ¶çš„è¡¨ç¤ºä¸º1101.101ï¼Œå³1.101101 * 2^3ã€‚\nå°†æŒ‡æ•°éƒ¨åˆ†åŠ ä¸Šåç§»é‡127ï¼Œå¾—åˆ°130ï¼Œåˆ™exponentéƒ¨åˆ†çš„å€¼ä¸º10000010ã€‚\nå› ä¸ºè§„å®šäº†å°æ•°çš„æœ€é«˜ä½æ€»æ˜¯éé›¶æ•°ï¼Œæ‰€ä»¥åœ¨äºŒè¿›åˆ¶ä¸­å®ƒæ€»æ˜¯ä¸º1ï¼Œå› æ­¤åœ¨å°¾æ•°éƒ¨åˆ†å¯ä»¥çœç•¥æœ€é«˜ä½çš„å‚¨å­˜ï¼Œåªè€ƒè™‘å°æ•°ç‚¹åé¢çš„æ•°å­—ã€‚å¦‚å‡‘ä¸å¤Ÿ23ä½åˆ™ä½ä½è¡¥é›¶ã€‚\n$$ {\\text{value}}=(-1)^{\\text{sign}}\\times 2^{(E-127)}\\times \\left(1+\\frac{M}{2^{23}}\\right) $$å…¶ä¸­ï¼Œ$\\frac{M}{2^{23}}$ å°†å°¾æ•° $M$ å½’ä¸€åŒ–åˆ°èŒƒå›´ $[0, 1)$ã€‚\nç‰›é¡¿è¿­ä»£æ³•æ±‚æ ¹ å¯¹äº $ f(x)=0 $ æœ‰ä¸€ä¸ªè¿‘ä¼¼è§£ $ x_n $ï¼Œé€šè¿‡ç»™å‡ºçš„æ ¹å¾—åˆ°æ›´è¿‘ä¼¼çš„æ ¹ã€‚\n$$ x_{n+1} = x_n - \\frac{f(x_n)}{f'(x_n)} $$ å·²ç»è¯æ˜ç‰›é¡¿è¿­ä»£æ³•çš„äºŒæ¬¡æ”¶æ•›æ¡ä»¶ï¼š ${\\displaystyle f'(x)\\neq 0}$ ; ${\\displaystyle x\\in I}$ï¼Œå…¶ä¸­ ${\\displaystyle I}$ ä¸ºåŒºé—´$[Î± âˆ’ r, Î± + r]$ ; ${\\displaystyle f(x)}$ åœ¨ ${\\displaystyle I}$ ä¸Šè¿ç»­å¯å¾®; åˆå§‹æ ¹ $x_0$ è¶³å¤Ÿæ¥è¿‘æ ¹ $x_*$\næœ€å¼€å§‹çš„æµ®ç‚¹æ•°å…¬å¼ï¼š $x=\\left(1+\\frac{M}{2^{23}}\\right) 2^{(E-127)}$\nä¸¤è¾¹åŒå–å¯¹æ•°ï¼Œ\n$$ \\begin{align} \\log_{2}(x) \u0026= \\log_{2}(\\left(1+\\frac{M}{2^{23}}\\right) 2^{(E-127)}) \\\\ \u0026= \\left(E-127\\right)+\\log_{2}(1+\\frac{M}{2^{23}}) \\end{align} $$åœ¨$ x \\in [0, 1]$ï¼Œ$\\log_{2}(1+x) \\approx x$ï¼Œ$ y=\\log_{2}(1+x) $ ä¸ $y=x$ åœ¨å›¾åƒä¸Šååˆ†æ¥è¿‘ã€‚ $$ \\begin{align} \\log_{2}(x) \u0026= \\left(E-127\\right)+\\log_{2}(1+\\frac{M}{2^{23}})\\\\ \u0026= \\frac{M}{2^{23}}+E-127 \\\\ \u0026= \\frac{M+2^{23} \\times E}{2^{23}}-127 \\end{align} $$æ­¤æ—¶ï¼Œ$M+2^{23}E$ å°±æ˜¯æµ®ç‚¹æ•°åœ¨äºŒè¿›åˆ¶ä¸­çš„è¡¨è¾¾ï¼Œå…¶ä¸­ $2^{23}$ ä½¿ $E$ åœ¨äºŒè¿›åˆ¶ä¸­å‘å·¦ç§»23ä½ã€‚\n$log_{2}(x) = \\frac{M+2^{23} \\times E}{2^{23}}-127 $ å…¶å®å°±æ˜¯æµ®ç‚¹æ•° $x$ ä¸å…¶åœ¨äºŒè¿›åˆ¶ä¸­çš„å…³ç³»\nè®¾æœ‰è§£ $a=\\frac{1}{\\sqrt{y}}$\n$\\log_{2}(a) = \\log_{2}(\\frac{1}{\\sqrt{y}}) = -\\frac{1}{2}\\log_{2}(y)$\nå°†æµ®ç‚¹æ•° $a$ å’Œ $y$ è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å½¢å¼ $A, Y$ï¼Œä»£å…¥ä¸Šå¼ï¼Œå¾—åˆ°\n$\\frac{A}{2^{23}}-127 = -\\frac{1}{2}\\left( \\frac{Y}{2^{23}}-127 \\right) $\n$A = 381 \\times 2^{22} + Î± - \\frac{1}{2}Y$\nè¿™ä¸ªå¼å­ï¼Œå…¶å®å°±æ˜¯è¿™è¡Œä»£ç çš„å«ä¹‰ï¼š\ni = 0x5f3759df - ( i \u003e\u003e 1 ); // what the fuck? ä½† 0x5f3759df è¿™ä¸ªå€¼æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿæˆ–å¥è¯è¯´ï¼Œå¦‚ä½•è®¡ç®—å‡ºæœ€ä½³çš„ä¿®æ­£å› å­$Î±$ï¼Ÿ\nå¼•å…¥ä¸€ä¸ªä¿®æ­£å› å­$Î±$ï¼Œä½¿å¾—ç›´çº¿ $y=x$ ä¸Šç§»ä¸ $y=\\log_{2}(1+x)$ åœ¨å›¾åƒä¸Šæ›´åŠ æ¥è¿‘ã€‚\n$$\\log_{2}(1+x) \\approx x+Î±$$åˆ‡æ¯”é›ªå¤«æœ€ä½³é€¼è¿‘ $$ E(\\alpha) = \\max_{x \\in [0,b]} \\left| (x + \\alpha) - \\log_2(1 + x) \\right| $$æœ€ä½³é€¼è¿‘ç›´çº¿ä¸º\n$$y=x+0.0431$$ Refs\nfloat32 Picture (By Fresheneesz at the English Wikipedia project, CC BY-SA 3.0, https://commons.wikimedia.org/w/index.php?curid=3357169)\nNewtonMethod Picture ä½œè€… Ralf Pfeifer - de:Image:NewtonIteration Ani.gifï¼ŒCC BY-SA 3.0ï¼Œhttps://commons.wikimedia.org/w/index.php?curid=2268473\n","wordCount":"336","inLanguage":"cn","datePublished":"2025-02-04T21:35:38+08:00","dateModified":"2025-02-04T21:35:38+08:00","author":{"@type":"Person","name":"LingC"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://moonlab.top/posts/2025/alg-graphics-1/"},"publisher":{"@type":"Organization","name":"MoonLab","logo":{"@type":"ImageObject","url":"https://moonlab.top/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://moonlab.top/ accesskey=h title="MoonLab (Alt + H)"><img src=/moon.svg alt aria-label=logo height=20>MoonLab</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://moonlab.top/en/ title=English aria-label=English>En</a></li></ul></div></div><ul id=menu><li><a href=https://moonlab.top/archives/ title=å½’æ¡£><span>å½’æ¡£</span></a></li><li><a href=https://moonlab.top/search/ title=æœç´¢><span>æœç´¢</span></a></li><li><a href=https://moonlab.top/about/ title=å…³äº><span>å…³äº</span></a></li><li><a href=https://www.travellings.cn/go.html target=_blank title=å¼€å¾€><span>å¼€å¾€</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><div class=body-layout><div class=leftbar></div><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">å¿«é€Ÿæ±‚è§£å¹³æ–¹æ ¹å€’æ•°ç®—æ³•</h1><div class=post-meta><span title='2025-02-04 21:35:38 +0800 +0800'>February 4, 2025</span>&nbsp;Â·&nbsp;LingC</div></header><div class=post-summary><span class=bold-text>ğŸ“¦ ç”±AIç”Ÿæˆçš„æ‘˜è¦</span><br><span class=post-summary-main>æœ¬æ–‡ä»‹ç»äº†ä¸€ç§å¿«é€Ÿè®¡ç®—å¹³æ–¹æ ¹å€’æ•°çš„ç®—æ³•ï¼Œè¯¥ç®—æ³•æºäºä¸Šä¸–çºª90å¹´ä»£ã€‚æ–‡ç« é¦–å…ˆè§£é‡Šäº†æµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„å­˜å‚¨æ–¹å¼ï¼Œç‰¹åˆ«æ˜¯float32æ ¼å¼çš„ç»“æ„ï¼ŒåŒ…æ‹¬ç¬¦å·ä½ã€æŒ‡æ•°ä½å’Œå°¾æ•°ä½ã€‚æ¥ç€ï¼Œä»‹ç»äº†ç‰›é¡¿è¿­ä»£æ³•çš„åŸºæœ¬åŸç†åŠå…¶åœ¨æ±‚è§£å¹³æ–¹æ ¹å€’æ•°ä¸­çš„åº”ç”¨ã€‚é€šè¿‡å¯¹æµ®ç‚¹æ•°çš„å¯¹æ•°å˜æ¢ï¼Œæ¨å¯¼å‡ºä¸å¹³æ–¹æ ¹å€’æ•°ç›¸å…³çš„å…¬å¼ï¼Œå¹¶è§£é‡Šäº†ä»£ç ä¸­ä½¿ç”¨çš„ç¥ç§˜å¸¸æ•° 0x5f3759df çš„æ¥æºï¼Œæœ€åæåˆ°åˆ‡æ¯”é›ªå¤«æœ€ä½³é€¼è¿‘çš„æ¦‚å¿µï¼Œä»¥ä¼˜åŒ–è®¡ç®—ç»“æœã€‚</span></div><div class=post-content><p>å¯¹äºå¿«é€Ÿè®¡ç®—å‡ºå¹³æ–¹æ ¹å€’æ•° $\frac{1}{\sqrt{x}}$ï¼Œæœ‰ä¸€ä¸ªä¸Šä¸–çºª90å¹´ä»£çš„ç»å…¸ç®—æ³•ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>float</span> <span style=color:#a6e22e>Q_rsqrt</span>( <span style=color:#66d9ef>float</span> number )
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>long</span> i;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>float</span> x2, y;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>float</span> threehalfs <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.5F</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    x2 <span style=color:#f92672>=</span> number <span style=color:#f92672>*</span> <span style=color:#ae81ff>0.5F</span>;
</span></span><span style=display:flex><span>    y  <span style=color:#f92672>=</span> number;
</span></span><span style=display:flex><span>    i  <span style=color:#f92672>=</span> <span style=color:#f92672>*</span> ( <span style=color:#66d9ef>long</span> <span style=color:#f92672>*</span> ) <span style=color:#f92672>&amp;</span>y;                       <span style=color:#75715e>// evil floating point bit level hacking
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    i  <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x5f3759df</span> <span style=color:#f92672>-</span> ( i <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>1</span> );               <span style=color:#75715e>// what the fuck? 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    y  <span style=color:#f92672>=</span> <span style=color:#f92672>*</span> ( <span style=color:#66d9ef>float</span> <span style=color:#f92672>*</span> ) <span style=color:#f92672>&amp;</span>i;
</span></span><span style=display:flex><span>    y  <span style=color:#f92672>=</span> y <span style=color:#f92672>*</span> ( threehalfs <span style=color:#f92672>-</span> ( x2 <span style=color:#f92672>*</span> y <span style=color:#f92672>*</span> y ) );   <span style=color:#75715e>// 1st iteration
</span></span></span><span style=display:flex><span><span style=color:#75715e>//  y  = y * ( threehalfs - ( x2 * y * y ) );   // 2nd iteration, this can be removed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> y;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h1 id=æ‰«ç›²æµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„å‚¨å­˜>æ‰«ç›²ï¼šæµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„å‚¨å­˜<a hidden class=anchor aria-hidden=true href=#æ‰«ç›²æµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­çš„å‚¨å­˜>#</a></h1><p>float32å’Œdouble64éƒ½ç”± IEE754 æ ‡å‡†å®šä¹‰ï¼Œåœ¨è¿™é‡Œåªç®€å•äº†è§£float32ã€‚</p><p><img loading=lazy src=Float_example.svg alt=float></p><p>åœ¨è¿™32ä½ä¸­åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†:</p><ul><li>Sign ç¬¦å·ï¼š0ä»£è¡¨æ•´æ•°ï¼Œ1ä»£è¡¨è´Ÿæ•°</li><li>Exponent æŒ‡æ•°ä½</li></ul><p>äºŒè¿›åˆ¶çš„8bitå¯ä»¥è¡¨ç¤º256ç§çŠ¶æ€ï¼Œè€ŒIEE754è§„å®šï¼Œè¿™å…«ä½ç”¨äºè¡¨ç¤º<code>[-127, 127]</code>èŒƒå›´å†…çš„æŒ‡æ•°ã€‚
ä¸ºäº†æ–¹ä¾¿åœ°è¡¨ç¤ºè´Ÿæ•°ï¼Œå…¶è§„å®šåœ¨float32ä¸­æŒ‡æ•°çš„åç§»é‡ä¸º127ï¼Œå› æ­¤æŒ‡æ•°çš„å®é™…å€¼ä¸º<code>e = exponent - 127</code>ã€‚
è¿™å°†ç¡®ä¿ä»¥äºŒè¿›åˆ¶å‚¨å­˜çš„<code>biased exponent</code>æ€»æ˜¯éè´Ÿæ•´æ•°ã€‚</p><ul><li>Fraction å°¾æ•°ä½</li></ul><p>å°¾æ•°ä½åœ¨æ ¼å¼ä¸­æœ‰23ä½ï¼Œå› æ­¤å¯ä»¥è¡¨ç¤ºçš„ç²¾åº¦ä¸º<code>2^-23</code>ï¼Œçº¦ç­‰äº<code>1.19 * 10^-7</code>ã€‚</p><p>å¦‚æœ‰ä¸€ä¸ªåè¿›åˆ¶æ•°<code>13.62</code>ï¼Œå°†æ•´æ•°éƒ¨åˆ†é™¤2å–ä½™é€†åºæ’åˆ—ä¸º<code>1101</code>ï¼Œå°†å°æ•°éƒ¨åˆ†ä¹˜2å–æ•´é¡ºåºæ’åˆ—ä¸º<code>101</code>ã€‚è¿™ä¸ªåè¿›åˆ¶å°æ•°åœ¨äºŒè¿›åˆ¶çš„è¡¨ç¤ºä¸º<code>1101.101</code>ï¼Œå³<code>1.101101 * 2^3</code>ã€‚</p><p>å°†æŒ‡æ•°éƒ¨åˆ†åŠ ä¸Šåç§»é‡127ï¼Œå¾—åˆ°130ï¼Œåˆ™<code>exponent</code>éƒ¨åˆ†çš„å€¼ä¸º<code>10000010</code>ã€‚</p><p>å› ä¸ºè§„å®šäº†å°æ•°çš„æœ€é«˜ä½æ€»æ˜¯éé›¶æ•°ï¼Œæ‰€ä»¥åœ¨äºŒè¿›åˆ¶ä¸­å®ƒæ€»æ˜¯ä¸º<code>1</code>ï¼Œå› æ­¤åœ¨å°¾æ•°éƒ¨åˆ†å¯ä»¥çœç•¥æœ€é«˜ä½çš„å‚¨å­˜ï¼Œåªè€ƒè™‘å°æ•°ç‚¹åé¢çš„æ•°å­—ã€‚å¦‚å‡‘ä¸å¤Ÿ23ä½åˆ™ä½ä½è¡¥é›¶ã€‚</p>$$
{\text{value}}=(-1)^{\text{sign}}\times 2^{(E-127)}\times \left(1+\frac{M}{2^{23}}\right)
$$<p>å…¶ä¸­ï¼Œ$\frac{M}{2^{23}}$ å°†å°¾æ•° $M$ å½’ä¸€åŒ–åˆ°èŒƒå›´ $[0, 1)$ã€‚</p><h1 id=ç‰›é¡¿è¿­ä»£æ³•æ±‚æ ¹>ç‰›é¡¿è¿­ä»£æ³•æ±‚æ ¹<a hidden class=anchor aria-hidden=true href=#ç‰›é¡¿è¿­ä»£æ³•æ±‚æ ¹>#</a></h1><p>å¯¹äº $ f(x)=0 $ æœ‰ä¸€ä¸ªè¿‘ä¼¼è§£ $ x_n $ï¼Œé€šè¿‡ç»™å‡ºçš„æ ¹å¾—åˆ°æ›´è¿‘ä¼¼çš„æ ¹ã€‚</p>$$
x_{n+1} = x_n - \frac{f(x_n)}{f'(x_n)}
$$<p><img loading=lazy src=NewtonIteration_Ani.gif alt=NewtonMethod></p><p>å·²ç»è¯æ˜ç‰›é¡¿è¿­ä»£æ³•çš„äºŒæ¬¡æ”¶æ•›æ¡ä»¶ï¼š
${\displaystyle f'(x)\neq 0}$ ; ${\displaystyle x\in I}$ï¼Œå…¶ä¸­ ${\displaystyle I}$ ä¸ºåŒºé—´$[Î± âˆ’ r, Î± + r]$ ; ${\displaystyle f(x)}$ åœ¨ ${\displaystyle I}$ ä¸Šè¿ç»­å¯å¾®; åˆå§‹æ ¹ $x_0$ è¶³å¤Ÿæ¥è¿‘æ ¹ $x_*$</p><p>æœ€å¼€å§‹çš„æµ®ç‚¹æ•°å…¬å¼ï¼š
$x=\left(1+\frac{M}{2^{23}}\right) 2^{(E-127)}$</p><p>ä¸¤è¾¹åŒå–å¯¹æ•°ï¼Œ</p>$$
\begin{align}
\log_{2}(x) &= \log_{2}(\left(1+\frac{M}{2^{23}}\right) 2^{(E-127)}) \\
&= \left(E-127\right)+\log_{2}(1+\frac{M}{2^{23}})
\end{align}
$$<p>åœ¨$ x \in [0, 1]$ï¼Œ$\log_{2}(1+x) \approx x$ï¼Œ$ y=\log_{2}(1+x) $ ä¸ $y=x$ åœ¨å›¾åƒä¸Šååˆ†æ¥è¿‘ã€‚
<img loading=lazy src=desmos-graph.png alt></p>$$
\begin{align}
\log_{2}(x) &= \left(E-127\right)+\log_{2}(1+\frac{M}{2^{23}})\\
&= \frac{M}{2^{23}}+E-127 \\
&= \frac{M+2^{23} \times E}{2^{23}}-127
\end{align}
$$<p>æ­¤æ—¶ï¼Œ$M+2^{23}E$ å°±æ˜¯æµ®ç‚¹æ•°åœ¨äºŒè¿›åˆ¶ä¸­çš„è¡¨è¾¾ï¼Œå…¶ä¸­ $2^{23}$ ä½¿ $E$ åœ¨äºŒè¿›åˆ¶ä¸­å‘å·¦ç§»23ä½ã€‚</p><p>$log_{2}(x) = \frac{M+2^{23} \times E}{2^{23}}-127 $ å…¶å®å°±æ˜¯æµ®ç‚¹æ•° $x$ ä¸å…¶åœ¨äºŒè¿›åˆ¶ä¸­çš„å…³ç³»</p><p>è®¾æœ‰è§£ $a=\frac{1}{\sqrt{y}}$</p><p>$\log_{2}(a) = \log_{2}(\frac{1}{\sqrt{y}}) = -\frac{1}{2}\log_{2}(y)$</p><p>å°†æµ®ç‚¹æ•° $a$ å’Œ $y$ è½¬åŒ–ä¸ºäºŒè¿›åˆ¶å½¢å¼ $A, Y$ï¼Œä»£å…¥ä¸Šå¼ï¼Œå¾—åˆ°</p><p>$\frac{A}{2^{23}}-127 = -\frac{1}{2}\left( \frac{Y}{2^{23}}-127 \right) $</p><p>$A = 381 \times 2^{22} + Î± - \frac{1}{2}Y$</p><p>è¿™ä¸ªå¼å­ï¼Œå…¶å®å°±æ˜¯è¿™è¡Œä»£ç çš„å«ä¹‰ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span>i  <span style=color:#f92672>=</span> <span style=color:#ae81ff>0x5f3759df</span> <span style=color:#f92672>-</span> ( i <span style=color:#f92672>&gt;&gt;</span> <span style=color:#ae81ff>1</span> );               <span style=color:#75715e>// what the fuck? 
</span></span></span></code></pre></div><p>ä½† <code>0x5f3759df</code> è¿™ä¸ªå€¼æ˜¯æ€ä¹ˆæ¥çš„å‘¢ï¼Ÿæˆ–å¥è¯è¯´ï¼Œå¦‚ä½•è®¡ç®—å‡ºæœ€ä½³çš„ä¿®æ­£å› å­$Î±$ï¼Ÿ</p><p>å¼•å…¥ä¸€ä¸ªä¿®æ­£å› å­$Î±$ï¼Œä½¿å¾—ç›´çº¿ $y=x$ ä¸Šç§»ä¸ $y=\log_{2}(1+x)$ åœ¨å›¾åƒä¸Šæ›´åŠ æ¥è¿‘ã€‚</p>$$\log_{2}(1+x) \approx x+Î±$$<h1 id=åˆ‡æ¯”é›ªå¤«æœ€ä½³é€¼è¿‘>åˆ‡æ¯”é›ªå¤«æœ€ä½³é€¼è¿‘<a hidden class=anchor aria-hidden=true href=#åˆ‡æ¯”é›ªå¤«æœ€ä½³é€¼è¿‘>#</a></h1>$$
E(\alpha) = \max_{x \in [0,b]} \left| (x + \alpha) - \log_2(1 + x) \right|
$$<p>æœ€ä½³é€¼è¿‘ç›´çº¿ä¸º</p>$$y=x+0.0431$$<hr><p>Refs</p><p>float32 Picture
(By Fresheneesz at the English Wikipedia project, CC BY-SA 3.0, <a href="https://commons.wikimedia.org/w/index.php?curid=3357169">https://commons.wikimedia.org/w/index.php?curid=3357169</a>)</p><p>NewtonMethod Picture
ä½œè€… Ralf Pfeifer - de:Image:NewtonIteration Ani.gifï¼ŒCC BY-SA 3.0ï¼Œhttps://commons.wikimedia.org/w/index.php?curid=2268473</p></div><footer class=post-footer><ul class=post-tags></ul></footer><script src=https://comment.moonlab.top/moontalk.js></script><div id=container></div><script>(new MoonTalk).init({page_key:window.location.href,server:"https:///comment.moonlab.top",element:"#container"})</script></article></main><aside class=rightbar><div class=rightbar-categories><h3>åˆ†ç±»</h3><ul class=rightbar-categories-first-list><li><a href=https://moonlab.top/categories/programming/>Programming</a> (16)<ul class=rightbar-categories-sec-list><li><a href=/tags/embeded>Embeded</a></li><li><a href=/tags/golang>golang</a></li><li><a href=/tags/linux>Linux</a></li><li><a href=/tags/android>Android</a></li></ul></li><li><a href=https://moonlab.top/categories/reverse/>Reverse</a> (1)<ul class=rightbar-categories-sec-list><li><a href=/tags/javascript>JavaScript</a></li></ul></li><li><a href=https://moonlab.top/categories/%E5%85%B6%E4%BB%96/>å…¶ä»–</a> (5)<ul class=rightbar-categories-sec-list><li><a href=/tags/blog>blog</a></li></ul></li><li><a href=https://moonlab.top/categories/%E7%AE%97%E6%B3%95/>ç®—æ³•</a> (4)<ul class=rightbar-categories-sec-list></ul></li></ul></div></aside></div><footer class=footer><img id=mooncounter-img style="margin:0 auto;margin-bottom:6px"></img>
<script src="//counter.moonlab.top/img?name=https://moonlab.top/"></script><span>&copy; 2025 <a href=https://moonlab.top/>MoonLab</a></span> Â·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span><a href=https://www.travellings.cn/go.html rel=noopener target=_blank><img style=height:27px alt=travelling src=https://www.travellings.cn/assets/logo.svg></a></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>