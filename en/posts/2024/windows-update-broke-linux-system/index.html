<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>[Dual Boot] Windows Update Destroyed My Linux System | MoonLab</title>
<meta name=keywords content="Linux"><meta name=description content="After a Windows update, the user&rsquo;s Linux system failed to boot due to a 90-second wait and encountered dependency failures. Investigation revealed that Windows swapped the order of the Linux partition and the recovery partition, leading to the issue. The user resolved the problem by repairing Linux, updating fstab, reinstalling Grub, and using efibootmgr to change the boot order."><meta name=author content="LingC"><link rel=canonical href=https://moonlab.top/en/posts/2024/windows-update-broke-linux-system/><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js></script><script>MathJax={tex:{displayMath:[["\\[","\\]"],["$$","$$"]],inlineMath:[["\\(","\\)"],["$","$"]]},loader:{load:["ui/safe"]}}</script><link crossorigin=anonymous href=/assets/css/stylesheet.1ff5a7b3bb4a96bf1747dfa25e8031167d4537d7ae4b78fac2b752886047a06e.css rel="preload stylesheet" as=style><link rel=icon href=/moon.svg type=image/svg+xml><link rel=icon type=image/png sizes=16x16 href=https://moonlab.top/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://moonlab.top/favicon-32x32.png><link rel=apple-touch-icon href=https://moonlab.top/apple-touch-icon.png><link rel=mask-icon href=https://moonlab.top/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=cn href=https://moonlab.top/posts/2024/windows-update-broke-linux-system/><link rel=alternate hreflang=en href=https://moonlab.top/en/posts/2024/windows-update-broke-linux-system/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="[Dual Boot] Windows Update Destroyed My Linux System"><meta property="og:description" content="After a Windows update, the user&rsquo;s Linux system failed to boot due to a 90-second wait and encountered dependency failures. Investigation revealed that Windows swapped the order of the Linux partition and the recovery partition, leading to the issue. The user resolved the problem by repairing Linux, updating fstab, reinstalling Grub, and using efibootmgr to change the boot order."><meta property="og:type" content="article"><meta property="og:url" content="https://moonlab.top/en/posts/2024/windows-update-broke-linux-system/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-08-03T08:28:35+08:00"><meta property="article:modified_time" content="2024-08-03T08:28:35+08:00"><meta property="og:site_name" content="MoonLab"><meta name=twitter:card content="summary"><meta name=twitter:title content="[Dual Boot] Windows Update Destroyed My Linux System"><meta name=twitter:description content="After a Windows update, the user&rsquo;s Linux system failed to boot due to a 90-second wait and encountered dependency failures. Investigation revealed that Windows swapped the order of the Linux partition and the recovery partition, leading to the issue. The user resolved the problem by repairing Linux, updating fstab, reinstalling Grub, and using efibootmgr to change the boot order."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://moonlab.top/en/posts/"},{"@type":"ListItem","position":2,"name":"[Dual Boot] Windows Update Destroyed My Linux System","item":"https://moonlab.top/en/posts/2024/windows-update-broke-linux-system/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"[Dual Boot] Windows Update Destroyed My Linux System","name":"[Dual Boot] Windows Update Destroyed My Linux System","description":"After a Windows update, the user\u0026rsquo;s Linux system failed to boot due to a 90-second wait and encountered dependency failures. Investigation revealed that Windows swapped the order of the Linux partition and the recovery partition, leading to the issue. The user resolved the problem by repairing Linux, updating fstab, reinstalling Grub, and using efibootmgr to change the boot order.","keywords":["Linux"],"articleBody":"After a Windows update, the user’s Linux system failed to boot due to a 90-second wait and encountered dependency failures. Investigation revealed that Windows swapped the order of the Linux partition and the recovery partition, leading to the issue. The user resolved the problem by repairing Linux, updating fstab, reinstalling Grub, and using efibootmgr to change the boot order.\nAs usual, I finished using Windows, clicked on update, and shut down. At that moment, I thought this Windows update was trivial and wouldn’t affect my computer.\nBut the next second, I switched to the Linux system and noticed something was wrong.\nI booted Linux directly from rEFInd, and everything was fine at first until a 90-second wait appeared:\nAfter the 90-second countdown ended, I couldn’t boot into the system:\nDependency failed for file system check Dependency failed for local file system Then the system entered emergency mode, but the terminal was accessible.\nMoreover, Grub also entered rescue mode, indicating there was a problem with the boot process.\nI checked the disk partitions and found that the 10GB Recovery partition of Windows had swapped places with the Linux system partition. It was all due to Windows running rampant on my computer.\nRepair Linux It seemed that there was an issue with a certain partition.\nI was completely baffled.\nThe partition labeled E4F3, which had been executing a certain task, turned out to be nonexistent. Then I looked at fstab and found that this E4F3 was supposed to be mounted to /boot/efi. It seemed that this partition was originally my ESP, and I didn’t know what the Windows update did to change the UUID of the ESP.\nAfter that, I used the device path directly instead of the UUID.\nRepair Grub It seemed that grub.cfg also used UUID to locate the ESP, which caused the problem this time.\nA quick fix can be done with two commands. (However, Grub will be added to the first order of UEFI boot.)\n$ sudo grub-install $ sudo grub-mkconfig -p /boot/grub/grub.cfg Then I used efibootmgr to change the boot order (I used rEFInd):\n$ sudo efibootmgr -o 0001,0002,0003... I really don’t understand why Windows updates have to be so troublesome.\n","wordCount":"364","inLanguage":"en","datePublished":"2024-08-03T08:28:35+08:00","dateModified":"2024-08-03T08:28:35+08:00","author":{"@type":"Person","name":"LingC"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://moonlab.top/en/posts/2024/windows-update-broke-linux-system/"},"publisher":{"@type":"Organization","name":"MoonLab","logo":{"@type":"ImageObject","url":"https://moonlab.top/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://moonlab.top/en/ accesskey=h title="MoonLab (Alt + H)"><img src=/moon.svg alt aria-label=logo height=20>MoonLab</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://moonlab.top/ title=简体中文 aria-label=简体中文>Cn</a></li></ul></div></div><ul id=menu><li><a href=https://moonlab.top/en/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://moonlab.top/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://moonlab.top/en/about/ title=About><span>About</span></a></li><li><a href=https://www.travellings.cn/go.html target=_blank title=Travel><span>Travel</span>&nbsp;<svg fill="none" shape-rendering="geometricPrecision" stroke="currentcolor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" viewBox="0 0 24 24" height="12" width="12"><path d="M18 13v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8a2 2 0 012-2h6"/><path d="M15 3h6v6"/><path d="M10 14 21 3"/></svg></a></li></ul></nav></header><div class=body-layout><div class=leftbar></div><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">[Dual Boot] Windows Update Destroyed My Linux System</h1><div class=post-meta><span title='2024-08-03 08:28:35 +0800 +0800'>August 3, 2024</span>&nbsp;·&nbsp;LingC&nbsp;|&nbsp;Read in other languages:<ul class=i18n_list><li><a href=https://moonlab.top/posts/2024/windows-update-broke-linux-system/>简体中文🇨🇳</a></li></ul></div></header><div class=post-summary><span class=bold-text>🖊️ AI Translation</span><br><span class=post-summary-main>This article was translated by AI.
&nbsp;<a class=primary-link href=https://moonlab.top/posts/2024/windows-update-broke-linux-system/>View original</a></span></div><div class=post-summary><span class=bold-text>📦 AI-generated Summary</span><br><span class=post-summary-main>After a Windows update, the user's Linux system failed to boot due to a 90-second wait and encountered dependency failures. Investigation revealed that Windows swapped the order of the Linux partition and the recovery partition, leading to the issue. The user resolved the problem by repairing Linux, updating fstab, reinstalling Grub, and using efibootmgr to change the boot order.</span></div><div class=post-content><p>After a Windows update, the user&rsquo;s Linux system failed to boot due to a 90-second wait and encountered dependency failures. Investigation revealed that Windows swapped the order of the Linux partition and the recovery partition, leading to the issue. The user resolved the problem by repairing Linux, updating fstab, reinstalling Grub, and using efibootmgr to change the boot order.</p><p>As usual, I finished using Windows, clicked on update, and shut down. At that moment, I thought this Windows update was trivial and wouldn’t affect my computer.</p><p>But the next second, I switched to the Linux system and noticed something was wrong.</p><p>I booted Linux directly from rEFInd, and everything was fine at first until a 90-second wait appeared:</p><p><img loading=lazy src=1.jpg alt=1></p><p>After the 90-second countdown ended, I couldn’t boot into the system:</p><pre tabindex=0><code>Dependency failed for file system check
Dependency failed for local file system
</code></pre><p>Then the system entered emergency mode, but the terminal was accessible.</p><p>Moreover, Grub also entered rescue mode, indicating there was a problem with the boot process.</p><p>I checked the disk partitions and found that the 10GB Recovery partition of Windows had swapped places with the Linux system partition. It was all due to Windows running rampant on my computer.</p><h1 id=repair-linux>Repair Linux<a hidden class=anchor aria-hidden=true href=#repair-linux>#</a></h1><p>It seemed that there was an issue with a certain partition.</p><p>I was completely baffled.</p><p>The partition labeled E4F3, which had been executing a certain task, turned out to be nonexistent. Then I looked at fstab and found that this E4F3 was supposed to be mounted to /boot/efi. It seemed that this partition was originally my ESP, and I didn’t know what the Windows update did to change the UUID of the ESP.</p><p><img loading=lazy src=2.jpg alt=fstab></p><p>After that, I used the device path directly instead of the UUID.</p><h1 id=repair-grub>Repair Grub<a hidden class=anchor aria-hidden=true href=#repair-grub>#</a></h1><p>It seemed that grub.cfg also used UUID to locate the ESP, which caused the problem this time.</p><p>A quick fix can be done with two commands. (However, Grub will be added to the first order of UEFI boot.)</p><pre tabindex=0><code>$ sudo grub-install
</code></pre><pre tabindex=0><code>$ sudo grub-mkconfig -p /boot/grub/grub.cfg
</code></pre><p>Then I used efibootmgr to change the boot order (I used rEFInd):</p><pre tabindex=0><code>$ sudo efibootmgr -o 0001,0002,0003...
</code></pre><p>I really don’t understand why Windows updates have to be so troublesome.</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://moonlab.top/en/tags/linux/>Linux</a></li></ul></footer><script src=https://comment.moonlab.top/moontalk.js></script><div id=container></div><script>(new MoonTalk).init({page_key:window.location.href,server:"https:///comment.moonlab.top",element:"#container"})</script></article></main><aside class=rightbar><div class=rightbar-categories><h3>Categories</h3><ul class=rightbar-categories-first-list><li><a href=https://moonlab.top/en/categories/programming/>Programming</a> (4)<ul class=rightbar-categories-sec-list><li><a href=/tags/linux>Linux</a></li><li><a href=/tags/android>Android</a></li></ul></li><li><a href=https://moonlab.top/en/categories/%E5%85%B6%E4%BB%96/>其他</a> (1)<ul class=rightbar-categories-sec-list><li><a href=/tags/linux>Linux</a></li></ul></li></ul></div></aside></div><footer class=footer><img id=mooncounter-img style="margin:0 auto;margin-bottom:6px"></img>
<script src="//counter.moonlab.top/img?name=https://moonlab.top/"></script><span>&copy; 2025 <a href=https://moonlab.top/en/>MoonLab</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span><a href=https://www.travellings.cn/go.html rel=noopener target=_blank><img style=height:27px alt=travelling src=https://www.travellings.cn/assets/logo.svg></a></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>